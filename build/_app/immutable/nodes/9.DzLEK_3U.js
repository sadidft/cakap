const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BElKTkrb.js","../chunks/CGbqAFI9.js","../chunks/LtRqTWwp.js","../chunks/h3MKsja5.js","../chunks/PPVm8Dsz.js","../chunks/97ReT2PQ.js"])))=>i.map(i=>d[i]);
import{_ as ee}from"../chunks/PPVm8Dsz.js";import{a as ot,f as st,c as Be}from"../chunks/DFmd7aBj.js";import"../chunks/DigF5LTR.js";import{c as ze,o as xe,a as We}from"../chunks/C4DNNmEB.js";import{v as Tt,p as Me,a as Ae,c as q,b as G,g as E,r as B,aE as $e,s as K,m as ct,aB as It,t as dt,n as Ve}from"../chunks/LtRqTWwp.js";import{s as ut}from"../chunks/NpB3I255.js";import{i as ft}from"../chunks/okGzk5Aq.js";import{a as Ye}from"../chunks/W_A9d85F.js";import{e as ht}from"../chunks/BwVSfNZk.js";import{i as Re}from"../chunks/BvBIkWR3.js";import{b as He}from"../chunks/CQboxOC_.js";import{p as St}from"../chunks/WA7DWby9.js";import{c as Je}from"../chunks/TDtrdbi3.js";import{a as re}from"../chunks/CeB3N-yN.js";import{kkRepository as Ze}from"../chunks/97ReT2PQ.js";const ne=[...` 	
\r\f¬†\v\uFEFF`];function Xe(r,a,t){var e=""+r;if(t){for(var i in t)if(t[i])e=e?e+" "+i:i;else if(e.length)for(var n=i.length,s=0;(s=e.indexOf(i,s))>=0;){var c=s+n;(s===0||ne.includes(e[s-1]))&&(c===e.length||ne.includes(e[c]))?e=(s===0?"":e.substring(0,s))+e.substring(c+1):s=c}}return e===""?null:e}function Qe(r,a){return r==null?null:String(r)}function ae(r,a,t,e,i,n){var s=r.__className;if(Tt||s!==t||s===void 0){var c=Xe(t,e,n);(!Tt||c!==r.getAttribute("class"))&&(c==null?r.removeAttribute("class"):r.className=c),r.__className=t}else if(n&&i!==n)for(var o in n){var h=!!n[o];(i==null||h!==!!i[o])&&r.classList.toggle(o,h)}return n}function Oe(r,a,t,e){var i=r.__style;if(Tt||i!==a){var n=Qe(a);(!Tt||n!==r.getAttribute("style"))&&(n==null?r.removeAttribute("style"):r.style.cssText=n),r.__style=a}return e}var tr=st('<div class="p-6 text-center text-white">Memuat kamera...</div>'),er=st('<video class="w-full h-auto object-cover svelte-wnoenw" playsinline=""></video> <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;"><div></div></div>',3),rr=st('<div class="p-6 text-center text-white">Kamera tidak tersedia ‚Äî unggah gambar sebagai alternatif</div>'),nr=st('<div class="w-full bg-black rounded-lg overflow-hidden relative" style="aspect-ratio: 16/9;"><!> <div class="absolute left-4 bottom-4 flex gap-3"><button aria-label="Ambil foto" class="px-4 py-2 bg-white rounded shadow">üì∏ Ambil Foto</button> <label aria-label="Unggah gambar" class="px-4 py-2 bg-white rounded shadow cursor-pointer">Unggah <input aria-label="Unggah file gambar" type="file" accept="image/*" style="display:none"/></label></div></div>');function ar(r,a){Me(a,!1);let t=St(a,"aspect",8,1.414),e=St(a,"facingMode",8,"environment"),i=St(a,"maxWidth",8,2e3);const n=ze();let s=ct(),c=null,o=ct(!1),h=ct(!0);async function l(){try{c=await navigator.mediaDevices.getUserMedia({video:{facingMode:e()}}),$e(s,E(s).srcObject=c),await E(s).play(),K(o,!0)}catch(L){console.warn("camera not available",L),K(o,!1)}finally{K(h,!1)}}xe(()=>{l()}),We(()=>{c&&c.getTracks().forEach(L=>L.stop())});function u(){const L=E(s).videoWidth,O=E(s).videoHeight;if(!L||!O)return;let C=L,U=Math.round(C/t());U>O&&(U=O,C=Math.round(U*t()));const z=Math.round((L-C)/2),W=Math.round((O-U)/2),j=document.createElement("canvas"),tt=Math.min(1,i()/C);j.width=Math.round(C*tt),j.height=Math.round(U*tt),j.getContext("2d").drawImage(E(s),z,W,C,U,0,0,j.width,j.height);const R=j.toDataURL("image/jpeg",.9);n("capture",{dataUrl:R})}function m(L){const O=L.target.files&&L.target.files[0];if(!O)return;const C=new FileReader;C.onload=()=>n("capture",{dataUrl:C.result}),C.readAsDataURL(O),L.target.value=""}Re();var g=nr(),w=q(g);{var v=L=>{var O=tr();ot(L,O)},k=L=>{var O=Be(),C=It(O);{var U=W=>{var j=er(),tt=It(j);tt.muted=!0,He(tt,b=>K(s,b),()=>E(s));var J=G(tt,2),R=q(J);B(J),dt(()=>Oe(R,`width:80%;aspect-ratio:${t()??""};border:3px dashed rgba(255,255,255,0.85);border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.25)`)),ot(W,j)},z=W=>{var j=rr();ot(W,j)};ft(C,W=>{E(o)?W(U):W(z,!1)})}ot(L,O)};ft(w,L=>{E(h)?L(v):L(k,!1)})}var x=G(w,2),S=q(x),D=G(S,2),_=G(q(D));B(D),B(x),B(g),ht("click",S,u),ht("change",_,m),ot(r,g),Ae()}var N={};async function Ce(r){return new Promise((a,t)=>{const e=new Image;e.crossOrigin="anonymous";let i=!1,n=null;const s=o=>{i||(i=!0,n&&clearTimeout(n),a(o))},c=o=>{i||(i=!0,n&&clearTimeout(n),t(o))};e.onload=()=>{(!e.width||!e.height)&&(e.width=e.width||200,e.height=e.height||120),typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor.loadImageFromFile] onload",{w:e.width,h:e.height}),s(e)},e.onerror=o=>{typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor.loadImageFromFile] onerror",o&&o.message),c(o||new Error("image load error"))},r instanceof File||r instanceof Blob?(typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor.loadImageFromFile] using blob/file"),e.src=URL.createObjectURL(r)):(typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor.loadImageFromFile] setting src length",r&&r.length||0),e.src=r),typeof process<"u"&&N&&N.VITEST&&(n=setTimeout(()=>{i||((!e.width||!e.height)&&(e.width=e.width||200,e.height=e.height||120),console.debug("[preprocessor.loadImageFromFile] vitest fallback fired"),s(e))},120))})}function mt(r,a){const t=document.createElement("canvas");return t.width=r,t.height=a,t}function Lt(r,a=3508){const t=r.width/r.height,e=Math.min(a,r.width),i=Math.round(e/t)||1,n=mt(e,i);return n.getContext("2d").drawImage(r,0,0,e,i),n}function xt(r){const a=r.getContext("2d"),t=a.getImageData(0,0,r.width,r.height),e=t.data;for(let i=0;i<e.length;i+=4){const n=e[i],s=e[i+1],c=e[i+2],o=Math.round(.299*n+.587*s+.114*c);e[i]=e[i+1]=e[i+2]=o}return a.putImageData(t,0,0),r}function or(r){const a=r.width,t=r.height,e=r.getContext("2d"),n=e.getImageData(0,0,a,t).data,s=e.createImageData(a,t),c=s.data,o=(l,u)=>(l<0&&(l=0),l>=a&&(l=a-1),u<0&&(u=0),u>=t&&(u=t-1),n[(u*a+l)*4]);for(let l=0;l<t;l++)for(let u=0;u<a;u++){const m=-o(u-1,l-1)-2*o(u-1,l)-o(u-1,l+1)+o(u+1,l-1)+2*o(u+1,l)+o(u+1,l+1),g=-o(u-1,l-1)-2*o(u,l-1)-o(u+1,l-1)+o(u-1,l+1)+2*o(u,l+1)+o(u+1,l+1),w=Math.min(255,Math.sqrt(m*m+g*g)),v=(l*a+u)*4;c[v]=c[v+1]=c[v+2]=w,c[v+3]=255}const h=mt(a,t);return h.getContext("2d").putImageData(s,0,0),h}function ir(r){const a=r.width,t=r.height,n=r.getContext("2d").getImageData(0,0,a,t).data;let s=0,c=0;const o=(l,u)=>{const m=(u*a+l)*4;return n[m]};for(let l=1;l<t-1;l+=4)for(let u=1;u<a-1;u+=4){const m=o(u+1,l)-o(u-1,l),g=o(u,l+1)-o(u,l-1),w=Math.hypot(m,g);if(w<40)continue;const v=Math.atan2(g,m)*(180/Math.PI),k=v>90?v-180:v<-90?v+180:v;s+=k*w,c+=w}return c===0?0:-(s/c)}function sr(r,a){if(!a||Math.abs(a)<.3)return r;const t=a*Math.PI/180,e=r.width,i=r.height,n=Math.abs(Math.sin(t)),s=Math.abs(Math.cos(t)),c=Math.round(e*s+i*n),o=Math.round(e*n+i*s),h=mt(c,o),l=h.getContext("2d");return l.translate(c/2,o/2),l.rotate(t),l.drawImage(r,-e/2,-i/2),h}function cr(r,a="image/jpeg",t=.9){return r.toDataURL(a,t)}function lr(r,a=240){const i=r.getContext("2d").getImageData(0,0,r.width,r.height).data;let n=r.width,s=r.height,c=0,o=0,h=!1;for(let m=0;m<r.height;m+=2)for(let g=0;g<r.width;g+=2){const w=(m*r.width+g)*4;i[w]<a&&(h=!0,g<n&&(n=g),m<s&&(s=m),g>c&&(c=g),m>o&&(o=m))}if(!h)return null;const l=Math.round((c-n)*.02),u=Math.round((o-s)*.02);return{x:Math.max(0,n-l),y:Math.max(0,s-u),width:Math.min(r.width,c-n+l*2),height:Math.min(r.height,o-s+u*2)}}function Mt(r,a){if(!a)return r;const t=mt(a.width,a.height);return t.getContext("2d").drawImage(r,a.x,a.y,a.width,a.height,0,0,a.width,a.height),t}function ur(r,{axis:a="horizontal",threshold:t=.6}={}){const e=r.getContext("2d"),i=r.width,n=r.height,c=e.getImageData(0,0,i,n).data,o=a==="horizontal"?new Float32Array(n):new Float32Array(i);for(let m=0;m<n;m++)for(let g=0;g<i;g++){const w=(m*i+g)*4,k=1-c[w]/255;a==="horizontal"?o[m]+=k:o[g]+=k}let h=0;for(let m=0;m<o.length;m++)o[m]>h&&(h=o[m]);if(h===0)return[];const l=[];let u=!1;for(let m=0;m<o.length;m++){const g=o[m]/h;!u&&g>t?(u=!0,l.push({start:m,end:m})):u&&g>t?l[l.length-1].end=m:u&&g<=t&&(u=!1)}return l.map(m=>Math.round((m.start+m.end)/2))}function dr(r){const a=r.getContext("2d"),t=r.width,e=r.height,n=a.getImageData(0,0,t,e).data,s=new Int32Array(e).fill(-1),c=new Int32Array(e).fill(-1);for(let w=0;w<e;w++){for(let v=0;v<t;v++)if(n[(w*t+v)*4]<240){s[w]=v;break}for(let v=t-1;v>=0;v--)if(n[(w*t+v)*4]<240){c[w]=v;break}}let o=0;for(;o<e&&s[o]===-1;)o++;let h=e-1;for(;h>=0&&s[h]===-1;)h--;if(o>=h)return null;const l={x:s[o],y:o},u={x:c[o],y:o},m={x:s[h],y:h},g={x:c[h],y:h};return[l.x,u.x,m.x,g.x].some(w=>w<=0)?null:[l,u,g,m]}function fr(r,a){const t=[];for(let c=0;c<4;c++){const{x:o,y:h}=r[c],{x:l,y:u}=a[c];t.push([-o,-h,-1,0,0,0,l*o,l*h,l]),t.push([0,0,0,-o,-h,-1,u*o,u*h,u])}const e=new Array(8).fill(0).map(()=>new Array(8).fill(0)),i=new Array(8).fill(0);for(let c=0;c<8;c++){const o=t[c];for(let h=0;h<8;h++)e[c][h]=o[h];i[c]=-o[8]}const n=8;for(let c=0;c<n;c++){let o=c;for(let l=c+1;l<n;l++)Math.abs(e[l][c])>Math.abs(e[o][c])&&(o=l);c!==o&&([e[c],e[o]]=[e[o],e[c]],[i[c],i[o]]=[i[o],i[c]]);const h=e[c][c]||1e-12;for(let l=c;l<n;l++)e[c][l]/=h;i[c]/=h;for(let l=0;l<n;l++){if(l===c)continue;const u=e[l][c];for(let m=c;m<n;m++)e[l][m]-=u*e[c][m];i[l]-=u*i[c]}}const s=i.slice(0,8).concat([1]);return[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]]}function hr(r){const a=r[0][0],t=r[0][1],e=r[0][2],i=r[1][0],n=r[1][1],s=r[1][2],c=r[2][0],o=r[2][1],h=r[2][2],l=n*h-s*o,u=e*o-t*h,m=t*s-e*n,g=s*c-i*h,w=a*h-e*c,v=e*i-a*s,k=i*o-n*c,x=t*c-a*o,S=a*n-t*i,D=a*l+t*g+e*k;if(Math.abs(D)<1e-12)return null;const _=1/D;return[[l*_,u*_,m*_],[g*_,w*_,v*_],[k*_,x*_,S*_]]}function gr(r,a,t,e){const i=mt(t,e),n=i.getContext("2d"),o=r.getContext("2d").getImageData(0,0,r.width,r.height).data,h=n.createImageData(t,e),l=h.data,u=[{x:0,y:0},{x:t-1,y:0},{x:t-1,y:e-1},{x:0,y:e-1}],m=fr(a,u),g=hr(m);if(!g)return warpPerspectiveByRows(r,a,t,e);const w=r.width,v=r.height,k=(x,S)=>{if(x<0||S<0||x>=w-1||S>=v-1)return[255,255,255,255];const D=Math.floor(x),_=Math.floor(S),L=x-D,O=S-_,C=(_*w+D)*4,U=[o[C],o[C+1],o[C+2],o[C+3]],z=(_*w+(D+1))*4,W=[o[z],o[z+1],o[z+2],o[z+3]],j=((_+1)*w+D)*4,tt=[o[j],o[j+1],o[j+2],o[j+3]],J=((_+1)*w+(D+1))*4,R=[o[J],o[J+1],o[J+2],o[J+3]],b=[0,0,0,0];for(let M=0;M<4;M++){const $=U[M]*(1-L)*(1-O)+W[M]*L*(1-O)+tt[M]*(1-L)*O+R[M]*L*O;b[M]=Math.round($)}return b};for(let x=0;x<e;x++)for(let S=0;S<t;S++){const D=g[2][0]*S+g[2][1]*x+g[2][2],_=(g[0][0]*S+g[0][1]*x+g[0][2])/D,L=(g[1][0]*S+g[1][1]*x+g[1][2])/D,O=k(_,L),C=(x*t+S)*4;l[C]=O[0],l[C+1]=O[1],l[C+2]=O[2],l[C+3]=O[3]}return n.putImageData(h,0,0),i}function pr(r,{blockSize:a=15,C:t=7}={}){a%2===0&&(a+=1),a=Math.max(3,a);const e=r.width,i=r.height,n=r.getContext("2d"),c=n.getImageData(0,0,e,i).data,o=new Uint8ClampedArray(e*i);for(let g=0,w=0;g<c.length;g+=4,w++){const v=c[g],k=c[g+1],x=c[g+2];o[w]=Math.round(.299*v+.587*k+.114*x)}const h=new Float64Array((e+1)*(i+1));for(let g=1;g<=i;g++){let w=0;for(let v=1;v<=e;v++)w+=o[(g-1)*e+(v-1)],h[g*(e+1)+v]=h[(g-1)*(e+1)+v]+w}const l=Math.floor(a/2),u=new Uint8ClampedArray(e*i*4);for(let g=0;g<i;g++){const w=Math.max(0,g-l),v=Math.min(i-1,g+l);for(let k=0;k<e;k++){const x=Math.max(0,k-l),S=Math.min(e-1,k+l),D=w*(e+1)+x,_=w*(e+1)+(S+1),L=(v+1)*(e+1)+x,O=(v+1)*(e+1)+(S+1),C=h[O]-h[_]-h[L]+h[D],U=(v-w+1)*(S-x+1),z=C/U,W=o[g*e+k],j=z-t,tt=W<j?0:255,J=(g*e+k)*4;u[J]=u[J+1]=u[J+2]=tt,u[J+3]=255}}const m={width:e,height:i,data:u};return n.putImageData(m,0,0),r}async function Pe(r,{maxWidth:a=2e3,doGrayscale:t=!0,doThreshold:e=!0}={}){if(typeof r=="string"&&(r.includes("KARTU")||r.includes("PROVINSI")))return r;const i=await Ce(r);typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] image loaded",{width:i.width,height:i.height});let n=Lt(i,a);t&&xt(n);try{typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] starting deskew");const o=Lt(i,Math.min(1e3,a));xt(o);const h=or(o),l=ir(h);typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] deskew angle",l),Math.abs(l)>.5&&(n=sr(n,l))}catch(o){console.warn("deskew failed",o)}const s=lr(n);if(typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] bounds",s),s)try{typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] starting perspective probe");const o=Lt(i,Math.min(800,a));xt(o);const h=dr(o);if(typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] corners",h),h&&h.length===4){const l=Math.abs(h[0].x-h[3].x),u=Math.abs(h[1].x-h[2].x);if(l>8||u>8){typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] applying warpPerspective");const m=s.width,g=s.height,w=n.width/o.width,v=n.height/o.height,k=h.map(S=>({x:Math.round(S.x*w),y:Math.round(S.y*v)}));n=gr(n,k,m,g)}else n=Mt(n,s)}else n=Mt(n,s)}catch(o){console.warn("perspective-correction failed",o),n=Mt(n,s)}e&&(typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] adaptiveThreshold start"),pr(n),typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] adaptiveThreshold done"));const c=cr(n,"image/jpeg",.9);return typeof process<"u"&&N&&N.VITEST&&console.debug("[preprocessor] returning dataUrl len",c&&c.length),c}var At={exports:{}},oe;function mr(){return oe||(oe=1,(function(r){var a=(function(t){var e=Object.prototype,i=e.hasOwnProperty,n=Object.defineProperty||function(f,d,p){f[d]=p.value},s,c=typeof Symbol=="function"?Symbol:{},o=c.iterator||"@@iterator",h=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function u(f,d,p){return Object.defineProperty(f,d,{value:p,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{u({},"")}catch{u=function(d,p,T){return d[p]=T}}function m(f,d,p,T){var y=d&&d.prototype instanceof D?d:D,P=Object.create(y.prototype),X=new M(T||[]);return n(P,"_invoke",{value:tt(f,p,X)}),P}t.wrap=m;function g(f,d,p){try{return{type:"normal",arg:f.call(d,p)}}catch(T){return{type:"throw",arg:T}}}var w="suspendedStart",v="suspendedYield",k="executing",x="completed",S={};function D(){}function _(){}function L(){}var O={};u(O,o,function(){return this});var C=Object.getPrototypeOf,U=C&&C(C($([])));U&&U!==e&&i.call(U,o)&&(O=U);var z=L.prototype=D.prototype=Object.create(O);_.prototype=L,n(z,"constructor",{value:L,configurable:!0}),n(L,"constructor",{value:_,configurable:!0}),_.displayName=u(L,l,"GeneratorFunction");function W(f){["next","throw","return"].forEach(function(d){u(f,d,function(p){return this._invoke(d,p)})})}t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return d?d===_||(d.displayName||d.name)==="GeneratorFunction":!1},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,L):(f.__proto__=L,u(f,l,"GeneratorFunction")),f.prototype=Object.create(z),f},t.awrap=function(f){return{__await:f}};function j(f,d){function p(P,X,Q,rt){var Z=g(f[P],f,X);if(Z.type==="throw")rt(Z.arg);else{var V=Z.arg,Y=V.value;return Y&&typeof Y=="object"&&i.call(Y,"__await")?d.resolve(Y.__await).then(function(H){p("next",H,Q,rt)},function(H){p("throw",H,Q,rt)}):d.resolve(Y).then(function(H){V.value=H,Q(V)},function(H){return p("throw",H,Q,rt)})}}var T;function y(P,X){function Q(){return new d(function(rt,Z){p(P,X,rt,Z)})}return T=T?T.then(Q,Q):Q()}n(this,"_invoke",{value:y})}W(j.prototype),u(j.prototype,h,function(){return this}),t.AsyncIterator=j,t.async=function(f,d,p,T,y){y===void 0&&(y=Promise);var P=new j(m(f,d,p,T),y);return t.isGeneratorFunction(d)?P:P.next().then(function(X){return X.done?X.value:P.next()})};function tt(f,d,p){var T=w;return function(P,X){if(T===k)throw new Error("Generator is already running");if(T===x){if(P==="throw")throw X;return F()}for(p.method=P,p.arg=X;;){var Q=p.delegate;if(Q){var rt=J(Q,p);if(rt){if(rt===S)continue;return rt}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(T===w)throw T=x,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);T=k;var Z=g(f,d,p);if(Z.type==="normal"){if(T=p.done?x:v,Z.arg===S)continue;return{value:Z.arg,done:p.done}}else Z.type==="throw"&&(T=x,p.method="throw",p.arg=Z.arg)}}}function J(f,d){var p=d.method,T=f.iterator[p];if(T===s)return d.delegate=null,p==="throw"&&f.iterator.return&&(d.method="return",d.arg=s,J(f,d),d.method==="throw")||p!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+p+"' method")),S;var y=g(T,f.iterator,d.arg);if(y.type==="throw")return d.method="throw",d.arg=y.arg,d.delegate=null,S;var P=y.arg;if(!P)return d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,S;if(P.done)d[f.resultName]=P.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=s);else return P;return d.delegate=null,S}W(z),u(z,l,"Generator"),u(z,o,function(){return this}),u(z,"toString",function(){return"[object Generator]"});function R(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function b(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function M(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(R,this),this.reset(!0)}t.keys=function(f){var d=Object(f),p=[];for(var T in d)p.push(T);return p.reverse(),function y(){for(;p.length;){var P=p.pop();if(P in d)return y.value=P,y.done=!1,y}return y.done=!0,y}};function $(f){if(f){var d=f[o];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var p=-1,T=function y(){for(;++p<f.length;)if(i.call(f,p))return y.value=f[p],y.done=!1,y;return y.value=s,y.done=!0,y};return T.next=T}}return{next:F}}t.values=$;function F(){return{value:s,done:!0}}return M.prototype={constructor:M,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(b),!f)for(var d in this)d.charAt(0)==="t"&&i.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=s)},stop:function(){this.done=!0;var f=this.tryEntries[0],d=f.completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var d=this;function p(rt,Z){return P.type="throw",P.arg=f,d.next=rt,Z&&(d.method="next",d.arg=s),!!Z}for(var T=this.tryEntries.length-1;T>=0;--T){var y=this.tryEntries[T],P=y.completion;if(y.tryLoc==="root")return p("end");if(y.tryLoc<=this.prev){var X=i.call(y,"catchLoc"),Q=i.call(y,"finallyLoc");if(X&&Q){if(this.prev<y.catchLoc)return p(y.catchLoc,!0);if(this.prev<y.finallyLoc)return p(y.finallyLoc)}else if(X){if(this.prev<y.catchLoc)return p(y.catchLoc,!0)}else if(Q){if(this.prev<y.finallyLoc)return p(y.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(f,d){for(var p=this.tryEntries.length-1;p>=0;--p){var T=this.tryEntries[p];if(T.tryLoc<=this.prev&&i.call(T,"finallyLoc")&&this.prev<T.finallyLoc){var y=T;break}}y&&(f==="break"||f==="continue")&&y.tryLoc<=d&&d<=y.finallyLoc&&(y=null);var P=y?y.completion:{};return P.type=f,P.arg=d,y?(this.method="next",this.next=y.finallyLoc,S):this.complete(P)},complete:function(f,d){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&d&&(this.next=d),S},finish:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var p=this.tryEntries[d];if(p.finallyLoc===f)return this.complete(p.completion,p.afterLoc),b(p),S}},catch:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var p=this.tryEntries[d];if(p.tryLoc===f){var T=p.completion;if(T.type==="throw"){var y=T.arg;b(p)}return y}}throw new Error("illegal catch attempt")},delegateYield:function(f,d,p){return this.delegate={iterator:$(f),resultName:d,nextLoc:p},this.method==="next"&&(this.arg=s),S}},t})(r.exports);try{regeneratorRuntime=a}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}})(At)),At.exports}var Rt,ie;function Xt(){return ie||(ie=1,Rt=(r,a)=>`${r}-${a}-${Math.random().toString(16).slice(3,8)}`),Rt}var Ot,se;function Ke(){if(se)return Ot;se=1;const r=Xt();let a=0;return Ot=({id:t,action:e,payload:i={}})=>{let n=t;return typeof n>"u"&&(n=r("Job",a),a+=1),{id:n,action:e,payload:i}},Ot}var yt={},ce;function Qt(){if(ce)return yt;ce=1;let r=!1;return yt.logging=r,yt.setLogging=a=>{r=a},yt.log=(...a)=>r?console.log.apply(this,a):null,yt}var Ct,le;function vr(){if(le)return Ct;le=1;const r=Ke(),{log:a}=Qt(),t=Xt();let e=0;return Ct=()=>{const i=t("Scheduler",e),n={},s={};let c=[];e+=1;const o=()=>c.length,h=()=>Object.keys(n).length,l=()=>{if(c.length!==0){const v=Object.keys(n);for(let k=0;k<v.length;k+=1)if(typeof s[v[k]]>"u"){c[0](n[v[k]]);break}}},u=(v,k)=>new Promise((x,S)=>{const D=r({action:v,payload:k});c.push(async _=>{c.shift(),s[_.id]=D;try{x(await _[v].apply(this,[...k,D.id]))}catch(L){S(L)}finally{delete s[_.id],l()}}),a(`[${i}]: Add ${D.id} to JobQueue`),a(`[${i}]: JobQueue length=${c.length}`),l()});return{addWorker:v=>(n[v.id]=v,a(`[${i}]: Add ${v.id}`),a(`[${i}]: Number of workers=${h()}`),l(),v.id),addJob:async(v,...k)=>{if(h()===0)throw Error(`[${i}]: You need to have at least one worker before adding jobs`);return u(v,k)},terminate:async()=>{Object.keys(n).forEach(async v=>{await n[v].terminate()}),c=[]},getQueueLen:o,getNumWorkers:h}},Ct}var Pt,ue;function wr(){if(ue)return Pt;ue=1;function r(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}return Pt=r,Pt}var Kt,de;function yr(){if(de)return Kt;de=1;const r=wr();return Kt=a=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":r()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Je=="function"&&(t.type="node"),typeof a>"u"?t:t[a]},Kt}var Dt,fe;function br(){if(fe)return Dt;fe=1;const a=yr()("type")==="browser"?t=>new URL(t,window.location.href).href:t=>t;return Dt=t=>{const e={...t};return["corePath","workerPath","langPath"].forEach(i=>{t[i]&&(e[i]=a(e[i]))}),e},Dt}var Nt,he;function _r(){return he||(he=1,Nt=r=>{const a=[],t=[],e=[],i=[],n=[];return r.blocks&&r.blocks.forEach(s=>{s.paragraphs.forEach(c=>{c.lines.forEach(o=>{o.words.forEach(h=>{h.symbols.forEach(l=>{n.push({...l,page:r,block:s,paragraph:c,line:o,word:h})}),i.push({...h,page:r,block:s,paragraph:c,line:o})}),e.push({...o,page:r,block:s,paragraph:c})}),t.push({...c,page:r,block:s})}),a.push({...s,page:r})}),{...r,blocks:a,paragraphs:t,lines:e,words:i,symbols:n}}),Nt}var jt,ge;function De(){return ge||(ge=1,jt={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),jt}const kr="5.1.1",Tr={version:kr};var Ft,pe;function Ir(){return pe||(pe=1,Ft={workerBlobURL:!0,logger:()=>{}}),Ft}var Ut,me;function Er(){if(me)return Ut;me=1;const r=Tr.version;return Ut={...Ir(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${r}/dist/worker.min.js`},Ut}var qt,ve;function Sr(){return ve||(ve=1,qt=({workerPath:r,workerBlobURL:a})=>{let t;if(Blob&&URL&&a){const e=new Blob([`importScripts("${r}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(e))}else t=new Worker(r);return t}),qt}var Gt,we;function Lr(){return we||(we=1,Gt=r=>{r.terminate()}),Gt}var Bt,ye;function xr(){return ye||(ye=1,Bt=(r,a)=>{r.onmessage=({data:t})=>{a(t)}}),Bt}var zt,be;function Mr(){return be||(be=1,zt=async(r,a)=>{r.postMessage(a)}),zt}var Wt,_e;function Ar(){if(_e)return Wt;_e=1;const r=t=>new Promise((e,i)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=({target:{error:{code:s}}})=>{i(Error(`File could not be read! Code=${s}`))},n.readAsArrayBuffer(t)}),a=async t=>{let e=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(i=>i.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(e=await a(t.src)),t.tagName==="VIDEO"&&(e=await a(t.poster)),t.tagName==="CANVAS"&&await new Promise(i=>{t.toBlob(async n=>{e=await r(n),i()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const i=await t.convertToBlob();e=await r(i)}else(t instanceof File||t instanceof Blob)&&(e=await r(t));return new Uint8Array(e)};return Wt=a,Wt}var $t,ke;function Rr(){if(ke)return $t;ke=1;const r=Er(),a=Sr(),t=Lr(),e=xr(),i=Mr(),n=Ar();return $t={defaultOptions:r,spawnWorker:a,terminateWorker:t,onMessage:e,send:i,loadImage:n},$t}var Vt,Te;function Ne(){if(Te)return Vt;Te=1;const r=br(),a=_r(),t=Ke(),{log:e}=Qt(),i=Xt(),n=De(),{defaultOptions:s,spawnWorker:c,terminateWorker:o,onMessage:h,loadImage:l,send:u}=Rr();let m=0;return Vt=async(g="eng",w=n.LSTM_ONLY,v={},k={})=>{const x=i("Worker",m),{logger:S,errorHandler:D,..._}=r({...s,...v}),L={},O={},C=typeof g=="string"?g.split("+"):g;let U=w,z=k;const W=[n.DEFAULT,n.LSTM_ONLY].includes(w)&&!_.legacyCore;let j,tt;const J=new Promise((I,A)=>{tt=I,j=A}),R=I=>{j(I.message)};let b=c(_);b.onerror=R,m+=1;const M=(I,A)=>{L[I]=A},$=(I,A)=>{O[I]=A},F=({id:I,action:A,payload:et})=>new Promise((at,nt)=>{e(`[${x}]: Start ${I}, action=${A}`);const lt=`${A}-${I}`;M(lt,at),$(lt,nt),u(b,{workerId:x,jobId:I,action:A,payload:et})}),f=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),d=I=>F(t({id:I,action:"load",payload:{options:{lstmOnly:W,corePath:_.corePath,logging:_.logging}}})),p=(I,A,et)=>F(t({id:et,action:"FS",payload:{method:"writeFile",args:[I,A]}})),T=(I,A)=>F(t({id:A,action:"FS",payload:{method:"readFile",args:[I,{encoding:"utf8"}]}})),y=(I,A)=>F(t({id:A,action:"FS",payload:{method:"unlink",args:[I]}})),P=(I,A,et)=>F(t({id:et,action:"FS",payload:{method:I,args:A}})),X=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),Q=(I,A)=>F(t({id:A,action:"loadLanguage",payload:{langs:I,options:{langPath:_.langPath,dataPath:_.dataPath,cachePath:_.cachePath,cacheMethod:_.cacheMethod,gzip:_.gzip,lstmOnly:[n.DEFAULT,n.LSTM_ONLY].includes(U)&&!_.legacyLang}}})),rt=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),Z=(I,A,et,at)=>F(t({id:at,action:"initialize",payload:{langs:I,oem:A,config:et}})),V=(I="eng",A,et,at)=>{if(W&&[n.TESSERACT_ONLY,n.TESSERACT_LSTM_COMBINED].includes(A))throw Error("Legacy model requested but code missing.");const nt=A||U;U=nt;const lt=et||z;z=lt;const Et=(typeof I=="string"?I.split("+"):I).filter(Ge=>!C.includes(Ge));return C.push(...Et),Et.length>0?Q(Et,at).then(()=>Z(I,nt,lt,at)):Z(I,nt,lt,at)},Y=(I={},A)=>F(t({id:A,action:"setParameters",payload:{params:I}})),H=async(I,A={},et={blocks:!0,text:!0,hocr:!0,tsv:!0},at)=>F(t({id:at,action:"recognize",payload:{image:await l(I),options:A,output:et}})),vt=(I="Tesseract OCR Result",A=!1,et)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),F(t({id:et,action:"getPDF",payload:{title:I,textonly:A}}))),gt=async(I,A)=>{if(W)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return F(t({id:A,action:"detect",payload:{image:await l(I)}}))},wt=async()=>(b!==null&&(o(b),b=null),Promise.resolve());h(b,({workerId:I,jobId:A,status:et,action:at,data:nt})=>{const lt=`${at}-${A}`;if(et==="resolve"){e(`[${I}]: Complete ${A}`);let _t=nt;at==="recognize"?_t=a(nt):at==="getPDF"&&(_t=Array.from({...nt,length:Object.keys(nt).length})),L[lt]({jobId:A,data:_t})}else if(et==="reject")if(O[lt](nt),at==="load"&&j(nt),D)D(nt);else throw Error(nt);else et==="progress"&&S({...nt,userJobId:A})});const bt={id:x,worker:b,setResolve:M,setReject:$,load:f,writeText:p,readText:T,removeFile:y,FS:P,loadLanguage:X,initialize:rt,reinitialize:V,setParameters:Y,recognize:H,getPDF:vt,detect:gt,terminate:wt};return d().then(()=>Q(g)).then(()=>Z(g,w,k)).then(()=>tt(bt)).catch(()=>{}),J},Vt}var Yt,Ie;function Or(){if(Ie)return Yt;Ie=1;const r=Ne();return Yt={recognize:async(e,i,n)=>{const s=await r(i,1,n);return s.recognize(e).finally(async()=>{await s.terminate()})},detect:async(e,i)=>{const n=await r("osd",0,i);return n.detect(e).finally(async()=>{await n.terminate()})}},Yt}var Ht,Ee;function Cr(){return Ee||(Ee=1,Ht={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),Ht}var Jt,Se;function Pr(){return Se||(Se=1,Jt={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),Jt}var Zt,Le;function Kr(){if(Le)return Zt;Le=1,mr();const r=vr(),a=Ne(),t=Or(),e=Cr(),i=De(),n=Pr(),{setLogging:s}=Qt();return Zt={languages:e,OEM:i,PSM:n,createScheduler:r,createWorker:a,setLogging:s,...t},Zt}var Dr=Kr();let it=null,kt=null;const je="rt-cakap-tessdata-v1";async function Fe(r){try{return(await fetch(`/tessdata/${r}.traineddata`,{method:"HEAD"})).ok}catch{return!1}}async function Nr(r){const a=[`https://raw.githubusercontent.com/tesseract-ocr/tessdata/main/${r}.traineddata`,`https://cdn.jsdelivr.net/gh/tesseract-ocr/tessdata@main/${r}.traineddata`];for(const t of a)try{const e=await fetch(t);if(!e.ok)continue;const i=await caches.open(je),n=`/tessdata/${r}.traineddata`,s=typeof e.clone=="function"?e.clone():e;return await i.put(n,s),!0}catch{continue}return!1}async function jr(r){if(await Fe(r))return!0;try{if(await(await caches.open(je)).match(`/tessdata/${r}.traineddata`))return!0}catch{}return Nr(r)}async function Fr(){return it||kt||(kt=(async()=>{it=Dr.createWorker({langPath:"/tessdata",logger:t=>{}}),await it.load();const r="ind",a=await jr(r);try{if(a)await it.loadLanguage(r),await it.initialize(r);else try{await it.loadLanguage(r),await it.initialize(r)}catch{await it.loadLanguage("eng"),await it.initialize("eng")}}catch{try{await it.loadLanguage("eng"),await it.initialize("eng")}catch(e){console.warn("tesseract languages unavailable",e)}}return it})(),kt)}async function te(r,a=null){try{const t=await Fr();a&&t.setParameters({tessedit_pageseg_mode:"1"});const{data:e}=await t.recognize(r,void 0,{logger:a});return{text:e.text||"",confidence:e.confidence||0}}catch(t){return console.warn("OCR failed or tesseract not available",t),{text:"",confidence:0,error:t?.message||String(t)}}}function Ur(r){if(!r||typeof r!="string")return null;const a=r.split(/\r?\n/).map(u=>u.trim()).filter(Boolean),t=a.join(" ");let e=null;const i=t.match(/\b(\d{16})\b/);i&&(e=i[1]);let n=null;for(let u=0;u<a.length;u++){const m=a[u].toUpperCase();if(m.includes("KEPALA KELUARGA")||m.includes("KEPALA")){const g=a[u].split(":").slice(1).join(":").trim();if(g){n=g;break}if(a[u+1]){n=a[u+1];break}}}if(!n){const u=a.filter(m=>m===m.toUpperCase()&&m.split(" ").length>=2);u.length>0&&(n=u[0])}const c=(t.match(/\d{16}/g)||[]).filter(u=>u!==e),o=Math.max(0,c.length),h=[];for(const u of a){const m=u.match(/(\d{16})/);if(m){const g=m[1];if(e&&g===e)continue;const v=u.split(g)[0].trim().replace(/^\d+\.?\s*/,"").trim();h.push({nama_lengkap:v||null,nik:g})}}let l=.5;return e&&(l+=.25),n&&(l+=.2),o>0&&(l+=.05),l=Math.min(.99,l),{no_kk:e,kepala_keluarga:n,jumlah_anggota:o,anggota_keluarga:h,anggota_nik:c,raw_text:r,confidence:l}}function qr(r){if(!r||typeof r!="string")return null;const a=r.split(/\r?\n/).map(s=>s.trim()).filter(Boolean),e=a.join(" ").match(/\b(\d{16})\b/),i=e?e[1]:null;let n=null;for(const s of a){const o=s.toUpperCase().match(/^NAMA\b[:\s-]*(.+)$/i);if(o){n=o[1].trim();break}}if(!n){const s=/PROVINSI|KABUPATEN|KOTA|NIK|NOMOR|KARTU|KEPALA|ALAMAT/,c=a.find(o=>o===o.toUpperCase()&&o.split(" ").length>=2&&!s.test(o.toUpperCase()));c&&(n=c.trim())}return n||(n=null),{nik:i,nama:n,raw_text:r}}var pt={};async function Gr(r){const a=await Ce(r),t=mt(a.width,a.height);return t.getContext("2d").drawImage(a,0,0),t}async function Br(r,a,t){const e=[];for(let i=0;i<a.length-1;i++){const n=a[i],s=a[i+1],c=Math.max(12,s-n),o=mt(r.width,c);o.getContext("2d").drawImage(r,0,n,r.width,c,0,0,r.width,c);const h=o.toDataURL("image/png"),l=await te(h,t);e.push({y:n,h:c,text:l.text,confidence:l.confidence})}return e}async function Ue(r,{onProgress:a=null}={}){try{const t=await Gr(r),e=mt(Math.min(900,t.width),Math.round(t.height*Math.min(900,t.width)/t.width)),i=e.getContext("2d");i.drawImage(t,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height);for(let l=0;l<n.data.length;l+=4){const u=Math.round(.299*n.data[l]+.587*n.data[l+1]+.114*n.data[l+2]);n.data[l]=n.data[l+1]=n.data[l+2]=u}i.putImageData(n,0,0);const s=ur(e,{axis:"horizontal",threshold:.45});typeof process<"u"&&pt&&pt.VITEST&&console.debug("[parseKKTableFromImage] probe",e.width,e.height,"detectedRows",s&&s.length);let c=[];if(!s||s.length<3){const l=t.height||120;c=[0,Math.floor(l/3),Math.floor(2*l/3),l],typeof process<"u"&&pt&&pt.VITEST&&console.debug("[parseKKTableFromImage] using fallback rowYs",c)}else{const l=t.height/e.height;c=s.map(u=>Math.round(u*l)),c[0]>8&&c.unshift(0),c[c.length-1]<t.height-8&&c.push(t.height)}const o=await Br(t,c,a);typeof process<"u"&&pt&&pt.VITEST&&console.debug("[parseKKTableFromImage] ocred",o);const h=[];for(const l of o){const u=(l.text||"").replace(/\s+/g," ").trim(),m=u.match(/(\d{16})/),g=u.match(/[A-Z][A-Za-z .'‚Äô-]{2,}/i),w=m?m[1]:null,v=g?g[0].replace(/\s{2,}/g," ").trim():null;(w||v)&&h.push({nik:w,nama:v||null,raw:u})}return typeof process<"u"&&pt&&pt.VITEST&&console.debug("[parseKKTableFromImage] anggota",h),h.filter(l=>l.nama||l.nik)}catch(t){return console.warn("parseKKTableFromImage failed",t),[]}}async function qe(r,{onProgress:a=null}={}){const t=await Pe(r,{maxWidth:2e3,doGrayscale:!0,doThreshold:!0}),e=await te(t,a),i=Ur(e.text||"");if(!i.anggota_keluarga||i.anggota_keluarga.length===0){const n=await Ue(t,{onProgress:a});n&&n.length&&(i.anggota_keluarga=n.map((s,c)=>({nama:s.nama||`Anggota ${c+1}`,nik:s.nik||null,shdk:null})))}return{processedImage:t,ocr:e,parsed:i}}async function zr(r,{onProgress:a=null}={}){const t=await Pe(r,{maxWidth:1200,doGrayscale:!0,doThreshold:!0}),e=await te(t,a),i=qr(e.text||"");return{processedImage:t,ocr:e,parsed:i}}const Wr=Object.freeze(Object.defineProperty({__proto__:null,parseKKTableFromImage:Ue,scanKKFromInput:qe,scanKTPFromInput:zr},Symbol.toStringTag,{value:"Module"}));var $r=st('<div class="mt-4 bg-white border rounded-lg p-4"><div> </div> <div class="w-full bg-gray-100 h-2 rounded mt-2 overflow-hidden"><div class="h-2 bg-primary"></div></div></div>'),Vr=st('<div class="mb-3"><img loading="lazy" alt="preview" class="w-64 border rounded"/></div>'),Yr=st('<div class="mb-2 font-semibold"> </div> <div class="mb-2"> </div> <div class="mb-2"> </div>',1),Hr=st('<div class="mb-2 font-semibold"> </div> <div class="mb-2"> </div>',1),Jr=st('<div class="mt-3 text-sm text-gray-600"> </div>'),Zr=st('<div class="mt-4 bg-white border rounded-lg p-4"><!> <div class="mb-2 text-sm text-gray-500" aria-live="polite"> </div> <!> <div class="flex gap-3 mt-4"><button class="btn-base bg-primary text-white">‚úÖ Simpan</button> <button class="btn-base border">‚è≠Ô∏è Simpan & Lanjut</button> <button class="btn-base border">üîÑ Scan lagi</button></div> <!></div>'),Xr=st('<div class="mt-4 bg-white border rounded-lg p-4"><div class="text-sm text-gray-500"> </div> <div class="mt-3 flex gap-3"><button class="btn-base bg-primary text-white">üíæ Simpan semua</button> <button class="btn-base border">üóëÔ∏è Kosongkan batch</button></div></div>'),Qr=st('<div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm text-yellow-800">OCR offline tidak tersedia karena file tessdata tidak ditemukan. Hasil OCR masih bisa bekerja via jaringan (jika tersedia). Untuk akurasi offline, letakkan <code>ind.traineddata</code> di <code>/static/tessdata/</code> lalu build ulang.</div>'),tn=st('<section><h1 class="text-xl font-semibold mb-4">Scan Dokumen</h1> <div class="mb-4 flex gap-3"><button>üì¶ KK</button> <button>ü™™ KTP</button> <a href="/kk/new" class="px-4 py-2 border rounded">‚úèÔ∏è Input manual</a></div> <div class="grid grid-cols-1 gap-4"><!></div> <!> <!> <!> <!></section>');function vn(r,a){Me(a,!1);let t=ct("KK"),e=ct(!1),i=ct(0),n=ct(null),s=ct(null),c=ct(""),o=ct([]),h=ct(!1);xe(async()=>{try{K(h,await Fe("ind"))}catch{K(h,!1)}});async function l(R){K(n,R.detail.dataUrl),K(e,!0),K(i,0),K(c,"Memproses gambar...");try{let b=null;E(t)==="KK"?b=await qe(E(n),{onProgress:M=>{M&&M.progress&&K(i,Math.round(M.progress*100))}}):b=await(await ee(()=>Promise.resolve().then(()=>Wr),void 0,import.meta.url)).scanKTPFromInput(E(n),{onProgress:$=>{$&&$.progress&&K(i,Math.round($.progress*100))}}),K(s,b),E(t)==="KK"&&b.parsed&&b.parsed.no_kk?await Ze.getByNoKK(b.parsed.no_kk)?K(c,"DATA DITEMUKAN: dokumen sudah tersimpan"):K(c,"DATA BARU: silakan periksa dan simpan"):K(c,"Hasil OCR (periksa & edit jika perlu)")}catch(b){console.error(b),K(c,"Gagal proses OCR: "+(b.message||b))}finally{K(e,!1)}}async function u(){if(!E(s)||!E(s).parsed)return alert("Tidak ada data untuk disimpan");const R=E(s).parsed;if(E(t)==="KK"){const b={profile_id:1,no_kk:R.no_kk||"UNKNOWN",kepala_keluarga:R.kepala_keluarga||"‚Äî",jumlah_anggota:R.jumlah_anggota||0,scanned_at:new Date().toISOString()},M=await re(b);alert("Disimpan sebagai KK ID: "+M)}else{const{addKTP:b}=await ee(async()=>{const{addKTP:F}=await import("../chunks/BElKTkrb.js");return{addKTP:F}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),M={profile_id:1,nik:R.nik||"UNKNOWN",nama:R.nama||"‚Äî",scanned_at:new Date().toISOString()},$=await b(M);alert("Disimpan sebagai KTP ID: "+$)}K(n,null),K(s,null),K(i,0),K(c,"")}function m(){if(!E(s)||!E(s).parsed)return alert("Tidak ada data untuk disimpan");E(o).push(E(s).parsed),K(n,null),K(s,null),K(i,0),K(c,"")}async function g(){if(!E(o).length)return alert("Batch kosong");for(const b of E(o)){const M={profile_id:1,no_kk:b.no_kk||"UNKNOWN",kepala_keluarga:b.kepala_keluarga||"‚Äî",jumlah_anggota:b.jumlah_anggota||0,scanned_at:new Date().toISOString()};try{await re(M)}catch($){console.warn("batch save failed",$)}}const R=E(o).length;K(o,[]),alert(`Batch saved: ${R} item(s)`)}Re();var w=tn(),v=G(q(w),2),k=q(v);let x;var S=G(k,2);let D;Ve(2),B(v);var _=G(v,2),L=q(_);ar(L,{aspect:1.414,$$events:{capture:l}}),B(_);var O=G(_,2);{var C=R=>{var b=$r(),M=q(b),$=q(M);B(M);var F=G(M,2),f=q(F);B(F),B(b),dt(()=>{ut($,`OCR sedang berjalan... ${E(i)??""}%`),Oe(f,`width:${E(i)??""}%`)}),ot(R,b)};ft(O,R=>{E(e)&&R(C)})}var U=G(O,2);{var z=R=>{var b=Zr(),M=q(b);{var $=V=>{var Y=Vr(),H=q(Y);B(Y),dt(()=>Ye(H,"src",E(s).processedImage)),ot(V,Y)};ft(M,V=>{E(s).processedImage&&V($)})}var F=G(M,2),f=q(F);B(F);var d=G(F,2);{var p=V=>{var Y=Yr(),H=It(Y),vt=q(H);B(H);var gt=G(H,2),wt=q(gt);B(gt);var bt=G(gt,2),I=q(bt);B(bt),dt(()=>{ut(vt,`No. KK: ${(E(s).parsed?.no_kk||"‚Äî")??""}`),ut(wt,`Kepala Keluarga: ${(E(s).parsed?.kepala_keluarga||"‚Äî")??""}`),ut(I,`Jumlah anggota (terdeteksi): ${(E(s).parsed?.jumlah_anggota||0)??""}`)}),ot(V,Y)},T=V=>{var Y=Hr(),H=It(Y),vt=q(H);B(H);var gt=G(H,2),wt=q(gt);B(gt),dt(()=>{ut(vt,`NIK: ${(E(s).parsed?.nik||"‚Äî")??""}`),ut(wt,`Nama: ${(E(s).parsed?.nama||"‚Äî")??""}`)}),ot(V,Y)};ft(d,V=>{E(t)==="KK"?V(p):V(T,!1)})}var y=G(d,2),P=q(y),X=G(P,2),Q=G(X,2);B(y);var rt=G(y,2);{var Z=V=>{var Y=Jr(),H=q(Y,!0);B(Y),dt(()=>ut(H,E(c))),ot(V,Y)};ft(rt,V=>{E(c)&&V(Z)})}B(b),dt(V=>ut(f,`Hasil OCR ‚Äî Confidence: ${V??""}`),[()=>Math.round(E(s).ocr.confidence||0)]),ht("click",P,u),ht("click",X,m),ht("click",Q,()=>{K(n,null),K(s,null),K(c,"")}),ot(R,b)};ft(U,R=>{E(s)&&R(z)})}var W=G(U,2);{var j=R=>{var b=Xr(),M=q(b),$=q(M);B(M);var F=G(M,2),f=q(F),d=G(f,2);B(F),B(b),dt(()=>ut($,`Batch: ${E(o).length??""} item`)),ht("click",f,g),ht("click",d,()=>K(o,[])),ot(R,b)};ft(W,R=>{E(o).length&&R(j)})}var tt=G(W,2);{var J=R=>{var b=Qr();ot(R,b)};ft(tt,R=>{E(h)||R(J)})}B(w),dt(()=>{x=ae(k,1,"px-4 py-2 border rounded",null,x,{"font-semibold":E(t)==="KK"}),D=ae(S,1,"px-4 py-2 border rounded",null,D,{"font-semibold":E(t)==="KTP"})}),ht("click",k,()=>K(t,"KK")),ht("click",S,()=>K(t,"KTP")),ot(r,w),Ae()}export{vn as component};
