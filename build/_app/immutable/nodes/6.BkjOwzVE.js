import{c as ka,a as g,f as y}from"../chunks/DFmd7aBj.js";import"../chunks/DigF5LTR.js";import{o as fa}from"../chunks/C4DNNmEB.js";import{p as xa,aC as ya,aD as ha,aB as wa,a as Ka,g as a,s as u,m as S,c as r,b as i,r as e,t as z,aE as p,u as A}from"../chunks/LtRqTWwp.js";import{s as R}from"../chunks/NpB3I255.js";import{i as G}from"../chunks/okGzk5Aq.js";import{e as ja,i as Aa}from"../chunks/DvyztBQG.js";import{r as J}from"../chunks/W_A9d85F.js";import{e as N}from"../chunks/BwVSfNZk.js";import{b as L}from"../chunks/BpknFwy2.js";import{b as Na}from"../chunks/BTTHKy0d.js";import{p as Ea}from"../chunks/D4Caz1gY.js";import{i as Ta}from"../chunks/BvBIkWR3.js";import{s as Da,a as Ia}from"../chunks/nvwr9ov8.js";import{s as Ra,g as Va}from"../chunks/Dz9M2qRO.js";import{kkRepository as E}from"../chunks/97ReT2PQ.js";const Sa=()=>{const T=Ra;return{page:{subscribe:T.page.subscribe},navigating:{subscribe:T.navigating.subscribe},updated:T.updated}},Ba={subscribe(T){return Sa().page.subscribe(T)}};var Ma=y('<div class="p-6 bg-white border rounded-lg">Memuat...</div>'),Pa=y('<button class="text-sm text-primary" aria-label="Edit KK">Edit</button>'),Ga=y('<form class="bg-white border rounded-lg p-4 space-y-4"><div><label class="text-sm text-gray-600">No. KK</label> <input class="w-full p-3 border rounded-md mt-1" placeholder="16 digit"/></div> <div><label class="text-sm text-gray-600">Kepala Keluarga</label> <input class="w-full p-3 border rounded-md mt-1" placeholder="Nama lengkap"/></div> <div class="grid grid-cols-2 gap-3"><div><label class="text-sm text-gray-600">Jumlah anggota</label> <input type="number" min="1" class="w-full p-3 border rounded-md mt-1"/></div> <div><label class="text-sm text-gray-600">Kategori</label> <select class="w-full p-3 border rounded-md mt-1"><option>WARGA_TETAP</option><option>PENDATANG</option><option>TIDAK_DITEMUKAN</option></select></div></div> <div><label class="text-sm text-gray-600">Alamat (jalan)</label> <input class="w-full p-3 border rounded-md mt-1" placeholder="JL. MERDEKA NO. 45"/></div> <div class="flex gap-3"><button class="btn-base bg-primary text-white" type="submit">Simpan</button> <button type="button" class="btn-base border">Batal</button></div></form>'),$a=y('<div class="bg-white border rounded-lg p-4 space-y-3"><div class="text-sm text-gray-500">No. KK</div> <div class="font-semibold flex items-center gap-3"><div> </div> <button class="text-sm text-primary">ðŸ“‹ Salin</button></div> <div class="text-sm text-gray-500">Kepala Keluarga</div> <div class="font-semibold flex items-center gap-3"><div> </div> <button class="text-sm text-primary">ðŸ“‹ Salin</button></div> <div class="text-sm text-gray-500">Jumlah Anggota</div> <div> </div> <div class="text-sm text-gray-500">Kategori</div> <div class="font-semibold"> </div></div>'),Ua=y('<div class="p-3 border rounded flex justify-between items-center"><div><div class="text-sm font-medium"> </div> <div class="text-sm text-gray-500"> </div></div> <div class="flex gap-2"><button class="px-3 py-1 border rounded text-sm">Rollback</button></div></div>'),Ja=y('<div class="space-y-2"></div>'),La=y('<div class="text-sm text-gray-500">Belum ada versi.</div>'),Wa=y('<div class="mt-4 bg-white border rounded-lg p-4"><div class="text-sm text-gray-500 mb-2">Riwayat Versi</div> <!></div>'),Ca=y('<div><div class="flex items-center justify-between mb-4"><h1 class="text-xl font-semibold">Kartu Keluarga</h1> <div class="flex gap-3"><!> <button class="text-sm text-primary">Kembali</button></div></div> <!> <div class="mt-4 bg-white border rounded-lg p-4"><div class="flex gap-3"><button class="btn-base border"> </button></div></div> <!></div>');function lt(T,F){xa(F,!1);const H=()=>Ia(Ba,"$page",ta),[ta,ea]=Da(),c=S();let s=S(null),h=S([]),$=S(!1);fa(async()=>{if(a(c)&&u(s,await E.getById(Number(a(c)))),a(c))try{u(h,await E.getVersions(Number(a(c))))}catch{u(h,[])}});function ra(){Va("/kk")}async function ia(d){confirm(`Rollback ke versi ${d.version_number}?`)&&(await E.applyVersion(d.id),u(s,await E.getById(Number(a(c)))),u(h,await E.getVersions(Number(a(c)))),alert("Rollback berhasil"))}let B=S(!1),t=S({no_kk:"",kepala_keluarga:"",jumlah_anggota:1,kategori:"",alamat_jalan:""});function sa(){u(B,!0),p(t,a(t).no_kk=a(s).no_kk||""),p(t,a(t).kepala_keluarga=a(s).kepala_keluarga||""),p(t,a(t).jumlah_anggota=a(s).jumlah_anggota||1),p(t,a(t).kategori=a(s).kategori||""),p(t,a(t).alamat_jalan=a(s).alamat_keluarga?.jalan||"")}function oa(){u(B,!1)}async function la(){if(!/^[0-9]{16}$/.test(a(t).no_kk))return alert("No. KK harus 16 digit angka");if(!a(t).kepala_keluarga||a(t).kepala_keluarga.trim()==="")return alert("Nama kepala keluarga wajib diisi");const d={no_kk:a(t).no_kk,kepala_keluarga:a(t).kepala_keluarga.toUpperCase(),jumlah_anggota:Number(a(t).jumlah_anggota)||0,kategori:a(t).kategori||a(s).kategori||"WARGA_TETAP",updated_at:new Date().toISOString(),change_note:"Edit via UI"};a(t).alamat_jalan&&(d.alamat_keluarga={...a(s).alamat_keluarga||{},jalan:a(t).alamat_jalan}),await E.update(Number(a(c)),d),u(s,await E.getById(Number(a(c)))),u(h,await E.getVersions(Number(a(c)))),u(B,!1),alert("Perubahan disimpan")}ya(()=>H(),()=>{u(c,H().params.id)}),ha(),Ta();var Q=ka(),da=wa(Q);{var na=d=>{var V=Ma();g(d,V)},va=d=>{var V=Ca(),W=r(V),X=i(r(W),2),Y=r(X);{var ua=l=>{var o=Pa();N("click",o,sa),g(l,o)};G(Y,l=>{a(B)||l(ua)})}var ma=i(Y,2);e(X),e(W);var Z=i(W,2);{var _a=l=>{var o=Ga(),b=r(o),w=i(r(b),2);J(w),e(b);var D=i(b,2),m=i(r(D),2);J(m),e(D);var n=i(D,2),k=r(n),v=i(r(k),2);J(v),e(k);var K=i(k,2),_=i(r(K),2),f=r(_);f.value=f.__value="WARGA_TETAP";var j=i(f);j.value=j.__value="PENDATANG";var I=i(j);I.value=I.__value="TIDAK_DITEMUKAN",e(_),e(K),e(n);var M=i(n,2),P=i(r(M),2);J(P),e(M);var U=i(M,2),q=i(r(U),2);e(U),e(o),L(w,()=>a(t).no_kk,x=>p(t,a(t).no_kk=x)),L(m,()=>a(t).kepala_keluarga,x=>p(t,a(t).kepala_keluarga=x)),L(v,()=>a(t).jumlah_anggota,x=>p(t,a(t).jumlah_anggota=x)),Na(_,()=>a(t).kategori,x=>p(t,a(t).kategori=x)),L(P,()=>a(t).alamat_jalan,x=>p(t,a(t).alamat_jalan=x)),N("click",q,oa),N("submit",o,Ea(la)),g(l,o)},ca=l=>{var o=$a(),b=i(r(o),2),w=r(b),D=r(w,!0);e(w);var m=i(w,2);e(b);var n=i(b,4),k=r(n),v=r(k,!0);e(k);var K=i(k,2);e(n);var _=i(n,4),f=r(_,!0);e(_);var j=i(_,4),I=r(j,!0);e(j),e(o),z(()=>{R(D,(a(s),A(()=>a(s).no_kk))),R(v,(a(s),A(()=>a(s).kepala_keluarga))),R(f,(a(s),A(()=>a(s).jumlah_anggota||0))),R(I,(a(s),A(()=>a(s).kategori||"â€”")))}),N("click",m,()=>navigator.clipboard.writeText(a(s).no_kk)),N("click",K,()=>navigator.clipboard.writeText(a(s).kepala_keluarga)),g(l,o)};G(Z,l=>{a(B)?l(_a):l(ca,!1)})}var C=i(Z,2),aa=r(C),O=r(aa),ga=r(O,!0);e(O),e(aa),e(C);var pa=i(C,2);{var ba=l=>{var o=Wa(),b=i(r(o),2);{var w=m=>{var n=Ja();ja(n,5,()=>a(h),Aa,(k,v)=>{var K=Ua(),_=r(K),f=r(_),j=r(f);e(f);var I=i(f,2),M=r(I,!0);e(I),e(_);var P=i(_,2),U=r(P);e(P),e(K),z(q=>{R(j,`Versi ${a(v),A(()=>a(v).version_number)??""} â€” ${q??""}`),R(M,(a(v),A(()=>a(v).change_note||"â€”")))},[()=>(a(v),A(()=>new Date(a(v).created_at).toLocaleString()))]),N("click",U,()=>ia(a(v))),g(k,K)}),e(n),g(m,n)},D=m=>{var n=La();g(m,n)};G(b,m=>{a(h),A(()=>a(h)&&a(h).length)?m(w):m(D,!1)})}e(o),g(l,o)};G(pa,l=>{a($)&&l(ba)})}e(V),z(()=>R(ga,a($)?"Sembunyikan Versi":"Lihat Versi")),N("click",ma,ra),N("click",O,()=>u($,!a($))),g(d,V)};G(da,d=>{a(s)?d(va,!1):d(na)})}g(T,Q),Ka(),ea()}export{lt as component};
